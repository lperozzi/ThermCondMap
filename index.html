<!DOCTYPE html>
<html>
  <head>

    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <link rel="shortcut icon" href="http://cartodb.com/assets/favicon.ico" />

    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" type="text/css" />
    <link rel="stylesheet" href="http://academy.cartodb.com/css/cdbui.css" type="text/css" />
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://jqueryui.com/resources/demos/style.css">
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
    <style>
    html, body, #map {
        height: 100%;
        padding: 0;
        margin: 0;
    }
    #button{
        position: absolute;
        top:180px;
        right:45px;
        text-align: right;
        width:200px;

        /*background: rgba(0, 0, 0, 0.8);*/
        /*abc*/
        /*padding: 25px 25px 25px 25px;*/
        /*border-radius: 20px;*/
    }
    .button > p {
        width:250px;
        color: #fff;
        left:300px;
        text-align: right;
    }

    .button ul {
        padding: 0;
        margin: 0;
        list-style-type: none;
        bottom: 36px;
        border-radius: 4px;
        width:300px;
    }
    .button li {
        padding: 4px;
        font-size: 16px;
        font: 'Roboto';
        color: #fff;
        cursor: pointer;
        width: 200px;
    }

    .btn-primary:hover, .btn-primary:focus, .btn-primary:active, .btn-primary.active, .open .dropdown-toggle.btn-primary {

        background-color: #404040;
        border-color: #FFF;
        color:#FFF;
        font: 400 14px/20px 'Roboto';
    }

    .btn
    {
        background-color: #404040;
        border-color: #FFF;
        color:#FFF;
        font: 400 14px/20px 'Roboto';
    }
    #cartocss {
        position: absolute;
        bottom: 300px;
        right: 20px;
    }

    #sql {
        position: absolute;
        top: 20px;
        right: 292px;
        wdth: 500px;
    }
    /*.button {
        position: absolute;
        right: 100px;
        bottom: 200px;
        font-family: "Proxima Nova W01", "Helvetica Neue", Helvetica, Arial, sans-serif;
        background: transparent;
    }
    .button > p {
        font-size: 17px;
        margin-bottom: 10px;
    }*/
    .layer_selector {
        background: #fff;
        border-radius: 4px;
        padding: 0;
        border: 1px solid #999999;
        width: 248px;
        height: 225px;
        box-shadow: rgba(0, 0, 0, 0.2) 0 0 4px 2px;
        font: 11px 'Helvetica';
        position: absolute;
        right: 20px;
        top: 350px;
    }

    .layer_selector > p {
        font: 900 16px/1 'Roboto';
        font-weight: bold;
        color: #666666;
        padding: 14px 14px 12px 14px;
        cursor: pointer;
        border-bottom: 1px solid #999;
    }

    .layer_selector ul {
        padding: 0;
        margin: 0;
        list-style-type: none;
        bottom: 36px;
        border-radius: 4px;
    }
    .layer_selector li {
        padding: 14px;
        font: 400 14px/1 'Roboto';
        /*font-size: 11px;*/
        color: #666666;
        cursor: pointer;
    }
    .layer_selector li:not(:last-child) {
        border-bottom: 1px solid #999;
    }
    .layer_selector li:hover {
        background-color: #e5e5e5;
        cursor: pointer;
    }
    .layer_selector li.sql_selected,
    .layer_selector li.cartocss_selected {
        background-color: #A6CEE3;
    }
    div.cartodb-legend-stack {
        bottom: 30px;
        right: 30px;
    }
    #textbox {
      position: absolute;
      top: 130px;
      color: rgba(255, 255, 255, 0.9);
      text-align: justify;
      font: 400 16px/20px 'Roboto';
      left: 100px;
      right: 500px;
     }
     .title-inner {
      position: absolute;
      top: 40px;
      right: 60px;
      left: 100px;
      text-align: left;
     }
     .title {
      position: relative;
      font:900 40px/1 'Roboto';
      color: #fff;
      z-index: 2;
      letter-spacing: 3px;
      display: inline-block;
     }
      .title:after {
          content:"";
          position: absolute;
          width: 50px;
          height: 0px;
          background: #fff;
          top: 50%;
          left: -70px;
      }
      .title:before {
          content:"";
          position: absolute;
          width: 50px;
          height: 0 px;
          background: #fff;
          top: 50%;
          right: -70px;
      }
      .leaflet-left .leaflet-control {
          margin-left: 30px;
          margin-top: 30px;
      }
      @media (max-width: 1200px) {
          #textbox {
              left: 80px;
              right: 80px;
          }
      }
      @media (max-width: 800px) {
          .layer_selector {
              right: auto;
              bottom: 30px;
              left: 30px;
          }
          .leaflet-control-container {
              display: none !important;
          }
          .header {
              position: absolute;
              background: #333;
              padding: 25px;
              top: 0;
              right: 0;
              left: 0;
          }
          .title-inner {
              position: static;
          }
          .title {
              font: 900 20px/1 'Roboto';
              margin-bottom: 10px;
          }
          #textbox {
              position: static;
              font: 400 12px/18px 'Roboto';
          }
          .layer_selector ul {
              height: 0;
              opacity: 0;
          }
          .layer_selector > p {
              border-bottom: 0;
              background: url(../Crime_Map/show.png) no-repeat 220px 15px;
          }
          .layer_selector.is-active > p {
              border-bottom: 0;
              background: url(../Crime_Map/hide.png) no-repeat 220px 15px;
          }
          .layer_selector.is-active ul {
              height: auto;
              opacity: 1;
          }
          .layer_selector.is-active > p {
              border-bottom: 1px solid #999;
          }
      }
      @media (max-width: 600px) {
          .layer_selector {
              right: 30px;
              bottom: 140px;
              left: auto;
          }
      }


    </style>
    <style type="cartocss/html" id="simple">
        /** simple visualization */

        #sgs_grid_2 {
            polygon-opacity: 0;
        }
    </style>
    <style type="cartocss/html" id="stdcss">
    /** choropleth visualization */

    #sgs_grid_2{
      polygon-fill: #c94741;
      polygon-opacity: .7;
      line-color: #FFF;
      line-width: 0.5;
      line-opacity: 1;
    }
    #sgs_grid_2 [ std <= 1] {
       polygon-fill: #c94741;
    }
    #sgs_grid_2 [ std <= 0.75] {
       polygon-fill: #f7b799;
    }
    #sgs_grid_2 [ std <= 0.5] {
       polygon-fill: #f7f6f6;
    }
    #sgs_grid_2 [ std <= 0.25] {
       polygon-fill: #a7d0e4;
    }
    #sgs_grid_2 [ std <= 0] {
       polygon-fill: #3783bb;
    }
    </style>

    <style type="cartocss/html" id="r3css">
    /** choropleth visualization */

    #sgs_grid_2{
    polygon-fill: #c94741;
    polygon-opacity: .7;
    line-color: #FFF;
    line-width: 0.5;
    line-opacity: 1;
    }
    #sgs_grid_2 [ r3 <= 4] {
    polygon-fill: #c94741;
    }
    #sgs_grid_2 [ r3 <= 3.5] {
    polygon-fill: #f7b799;
    }
    #sgs_grid_2 [ r3 <= 3] {
    polygon-fill: #f7f6f6;
    }
    #sgs_grid_2 [ r3 <= 2.5] {
    polygon-fill: #a7d0e4;
    }
    #sgs_grid_2 [ r3 <= 2] {
    polygon-fill: #3783bb;
    }
    </style>

    <style type="cartocss/html" id="meancss">
    /** choropleth visualization */

    #sgs_grid_2{
    polygon-fill: #c94741;
    polygon-opacity: .7;
    line-color: #FFF;
    line-width: 0.5;
    line-opacity: 1;
    }
    #sgs_grid_2 [ mean <= 4] {
    polygon-fill: #c94741;
    }
    #sgs_grid_2 [ mean <= 3.5] {
    polygon-fill: #f7b799;
    }
    #sgs_grid_2 [ mean <= 3] {
    polygon-fill: #f7f6f6;
    }
    #sgs_grid_2 [ mean <= 2.5] {
    polygon-fill: #a7d0e4;
    }
    #sgs_grid_2 [ mean <= 2] {
    polygon-fill: #3783bb;
    }
    </style>


    <style type="cartocss/html" id="thermostraticss">
    /** category visualization */

    /** category visualization */

    /** category visualization */

    #geology {
    polygon-opacity: 0.7;
    line-color: #000000;
    line-width: 0.2;
    line-opacity: 0.6;
    }
    #geology[unite_stra="Appalaches"] {
    polygon-fill: #e31a1c;
    }
    #geology[unite_stra="Beauharnois"] {
    polygon-fill: #feb24c;
    }
    #geology[unite_stra="Cairnside et Covey Hill"] {
    polygon-fill: #fc4e2a;
    }
    #geology[unite_stra="Grenville"] {
    polygon-fill: #b10026;
    }
    #geology[unite_stra="Queenston et Lorraine"] {
    polygon-fill: #ffffcc;
    }
    #geology[unite_stra="St. Rosalie et Utica"] {
    polygon-fill: #ffeda0;
    }
    #geology[unite_stra="Theresa"] {
    polygon-fill: #fd8d3c;
    }
    #geology[unite_stra="Trenton, Black River, Chazy"] {
    polygon-fill: #fed976;
    }
    #geology[unite_stra=null] {
    polygon-fill: #FFFFFF;
    polygon-opacity: 0;
    }
    </style>

    <style type="cartocss/html" id="geologycss">
    /** category visualization */

    /** category visualization */

    #geology {
       polygon-opacity: 0;
       line-color: #000000;
       line-width: 0.5;
       line-opacity: 1;
    }

    #geology[formation="Formation de Beauharnois"] {
       polygon-fill: #eae1fc;
      polygon-opacity: .7;
    }
    #geology[formation="Formation de Deschambault"] {
       polygon-fill: #aacbfd;
      polygon-opacity: .7;
    }
    #geology[formation="Formation de Cairnside"] {
       polygon-fill: #fdfcb5;
      polygon-opacity: .7;
    }
    #geology[formation="Formation de Laval"] {
       polygon-fill: #d6ffff;
      polygon-opacity: .7;
    }
    #geology[formation="Formation de Tétreauville (Région de Montréal); Formation de Neuville, Membre de Grondines (Région de Québec)"] {
       polygon-fill: #d7e4f9;
      polygon-opacity: .7;
    }
    #geology[formation="Shale d'Utica"] {
       polygon-fill: #cba053;
      polygon-opacity: .7;
    }
    #geology[formation="Formation de Theresa"] {
       polygon-fill: #fcea91;
      polygon-opacity: .7;
    }
    #geology[formation="Formations de Leray, de Lowville et de Pamelia"] {
       polygon-fill: #44f4f3;
      polygon-opacity: .7;
    }
    #geology[formation="Formations de Montréal et de Neuville"] {
       polygon-fill: #3d99fc;
      polygon-opacity: .7;
    }
    #geology[formation="Formation de Covey Hill"] {
       polygon-fill: #f4d854;
      polygon-opacity: .7;
    }
    #geology[formation="Formation de Nicolet"] {
       polygon-fill: #e5d0a9;
      polygon-opacity: .7;
    }

    </style>


    <style type="cartocss/html" id="epaisseurcss">
    /** choropleth visualization */

    #epaisseur{
        polygon-fill: #FFFFCC;
        polygon-opacity: 0.7;
        line-color: #FFF;
        line-width: 0.1;
        line-opacity: 1;
    }
    #epaisseur [ gridcode <= 150] {
        polygon-fill: #084081;
    }
    #epaisseur [ gridcode <= 100] {
        polygon-fill: #0868ac;
    }
    #epaisseur [ gridcode <= 50] {
        polygon-fill: #2b8cbe;
    }
    #epaisseur [ gridcode <= 40] {
        polygon-fill: #4eb3d3;
    }
    #epaisseur [ gridcode <= 30] {
        polygon-fill: #7bccc4;
    }
    #epaisseur [ gridcode <= 20] {
        polygon-fill: #a8ddb5;
    }
    #epaisseur [ gridcode <= 15] {
        polygon-fill: #ccebc5;
    }
    #epaisseur [ gridcode <= 10] {
        polygon-fill: #e0f3db;
    }
    #epaisseur [ gridcode <= 5] {
        polygon-fill: #f7fcf0;
    }
    </style>

    <style type="cartocss/html" id="mesurescss">
    /** choropleth visualization */

    #marmot_forages_affleurements{
        marker-fill-opacity: 1;
        marker-line-color: #000000;
        marker-line-width: 1;
        marker-line-opacity: 1;
        marker-width: 15;
        marker-fill: #c94741;
        marker-allow-overlap: true;
    }
    #marmot_forages_affleurements [ cond <= 4] {
        marker-fill: #c94741;
    }
    #marmot_forages_affleurements [ cond <= 3.5] {
        marker-fill: #f7b799;
    }
    #marmot_forages_affleurements [ cond <= 3] {
        marker-fill: #f7f6f6;
    }
    #marmot_forages_affleurements [ cond <= 2.5] {
        marker-fill: #a7d0e4;
    }
    </style>

    <style type="cartocss/html" id="datasynthscss">
    /** choropleth visualization */

    #data_synth{
        marker-fill-opacity: 1;
        marker-line-color: #000000;
        marker-line-width: 1;
        marker-line-opacity: 1;
        marker-width: 10;
        marker-fill: #c94741;
        marker-allow-overlap: true;
    }
    #data_synth [ cond <= 4] {
        marker-fill: #c94741;
    }
    #data_synth [ cond <= 3.5] {
        marker-fill: #f7b799;
    }
    #data_synth [ cond <= 3] {
        marker-fill: #f7f6f6;
    }
    #data_synth [ cond <= 2.5] {
        marker-fill: #a7d0e4;
    }
    </style>

  </head>
  <body>
      <div id="map"></div>
      <div class="header">
          <div class="title-inner">
              <h1 style="text-transform:uppercase;" class="title">Conductivité thermique</h1>
          </div>

          <div id="textbox">
              <p>Carte des conductivités thermiques au niveau du roc dans la communauté métropolitaine de Montréal. </p>
              <!-- Dix réalisations de conductivité thermique on été génerée
                  en utilisant l'algorithme des simulation gaussiennes séquentielles à partir de mesures de TRT dans le forages
                  ainsi que sur des affleurements. Des données -->
          </div>
      </div>
      <!-- <div id="cartocss" class="layer_selector">
          <p>CartoCSS Selectors</p>
          <ul>
              <li data="r3" data-type="cartocss" class='vio'>Realisation stochastique
              </li>
              <li data="mean" data-type="cartocss" class='vio'>Moyenne des simulations</li>
              <li data="std" data-type="cartocss">Écart-type des simulations
              </li>
              <li data="simple" data-type="cartocss">Désactiver les cartes
              </li>
          </ul>

      </div> -->

      <div id= "button" class="button">
          <ul>
              <li style="font-size:18px;text-transform:uppercase">Données</li>
              <li><button id="forage" class="btn btn-primary">Mesures de forages</button></li>
              <li><button id="affleurement" class="btn btn-primary">Mesures d'affleurements</button></li>
              <li><button id="synth" class="btn btn-primary">Donnée synthetiques</button></li>
          </ul>
          <ul>
              <li style="font-size:18px;text-transform:uppercase">Simulations</li>
              <li><button id="real" class="btn btn-primary">Realisation stochastique</button></li>
              <li><button id="mean" class="btn btn-primary">Moyenne des realisations</button></li>
              <li><button id="std" class="btn btn-primary">Incertitude</button></li>
              <li></li>
          </ul>
          <ul>
              <li style="font-size:18px;text-transform:uppercase;">Géologie</li>
              <li><button id="thermostrati" class="btn btn-primary">Unités thermostrati.</button></li>
              <li><button id="geology" class="btn btn-primary">Géologie détaillé</button></li>
              <li><button id="epaisseur" class="btn btn-primary">Epaisseur dépôts meubles</button></li>
          </ul>
          <ul>
              <li></li>
              <!-- <li >Title</li> -->
              <li style="font-size:12px;"><div id="slider-range-min"></div></li>
          </ul>
      </div>

      <script id='infowindow_mesures' type="infowindow/html">
      <div class="cartodb-tooltip-content-wrapper dark">
        <div class="cartodb-tooltip-content">
          <h4 style="text-transform:none;font-size:14px">Conductivité thermique (W/mK)</h4>
          <p>{{cond}}</p>
        </div>
      </div>
      </script>

      <script id='infowindow_r3' type="infowindow/html">
      <div class="cartodb-tooltip-content-wrapper dark">
        <div class="cartodb-tooltip-content">
          <h4 style="text-transform:none;font-size:14px">Conductivité thermique simulé  pour une réalisation (W/mK) </h4>
          <p>{{r3}}</p>
        </div>
      </div>
      </script>

      <script id='infowindow_mean' type="infowindow/html">
      <div class="cartodb-tooltip-content-wrapper dark">
        <div class="cartodb-tooltip-content">
          <h4 style="text-transform:none;font-size:14px">Conductivité thermique simulé moyenne (W/mK)</h4>
          <p>{{mean}}</p>
        </div>
      </div>
      </script>

      <script id='infowindow_std' type="infowindow/html">
      <div class="cartodb-tooltip-content-wrapper dark">
        <div class="cartodb-tooltip-content">
          <h4 style="text-transform:none;font-size:14px">Écart-type des simulations</h4>
          <p>{{std}}</p>
        </div>
      </div>
      </script>


      <script type="infowindow/html" id="infowindow_geology">
        <div class="cartodb-popup v2">
        <a href="#close" class="cartodb-popup-close-button close">x</a>

           <div class="cartodb-popup-content-wrapper">

             <div class="cartodb-popup-content">
               <h4 style="text-transform:none;font-size:14px;color:#404040">Géologie</h4>
               <p style="text-transform:none;font-size:14px;color:#000">{{formation}}</p>
             </div>
           </div>
           <div class="cartodb-popup-tip-container"></div>
        </div>
      </script>

      <script type="infowindow/html" id="infowindow_geology">
        <div class="cartodb-popup v2">
          <a href="#close" class="cartodb-popup-close-button close">x</a>
           <div class="cartodb-popup-content-wrapper">
             <div class="cartodb-popup-content">
               <!-- content.data contains the field info -->
               <h4 style="text-transform:none;font-size:14px;color:#404040">Géologie </h4>
               <p style="text-transform:none;font-size:14px;color:#000">{{formation}}</p>
             </div>
           </div>
           <div class="cartodb-popup-tip-container"></div>
        </div>
      </script>

      <script type="infowindow/html" id="infowindow_epaisseur">
        <div class="cartodb-popup v2">
          <a href="#close" class="cartodb-popup-close-button close">x</a>
           <div class="cartodb-popup-content-wrapper">
             <div class="cartodb-popup-content">
               <!-- content.data contains the field info -->
               <h4 style="text-transform:none;font-size:14px;color:#404040">Epaisseur dépôts meubles </h4>
               <p style="text-transform:none;font-size:14px;color:#000">{{gridcode}} mètres</p>
             </div>
           </div>
           <div class="cartodb-popup-tip-container"></div>
        </div>
      </script>

      <script type="infowindow/html" id="infowindow_synth">
      <div class="cartodb-tooltip-content-wrapper dark">
        <div class="cartodb-tooltip-content">
          <h4 style="text-transform:none;font-size:14px">Conductivité thermique synthétique (W/mK) </h4>
          <p>{{cond}}</p>
        </div>
      </div>
      </script>

      <script type="infowindow/html" id="infowindow_thermostrati">
        <div class="cartodb-popup v2">
          <a href="#close" class="cartodb-popup-close-button close">x</a>
           <div class="cartodb-popup-content-wrapper">
             <div class="cartodb-popup-content">
               <!-- content.data contains the field info -->
               <h4 style="text-transform:none;font-size:14px;color:#404040">Unité thermostratigraphique </h4>
               <p style="text-transform:none;font-size:14px;color:#000">{{unite_stra}}</p>
             </div>
           </div>
           <div class="cartodb-popup-tip-container"></div>
        </div>
      </script>


      <!-- <script id='infowindow_epaisseur' type="infowindow/html">
      <div class="cartodb-tooltip-content-wrapper dark">
        <div class="cartodb-tooltip-content">
          <h4 style="text-transform:none;font-size:14px">Epaisseur dépôts meubles (m)</h4>
          <p>{{gridcode}}</p>
        </div>
      </div>
      </script> -->

      <!-- include cartodb.js library -->
      <script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js" type="text/javascript"></script>
      <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
      <script src="http://code.jquery.com/ui/1.11.1/jquery-ui.js"></script>
      <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
      <!-- include google maps library *before* load cartodb.js -->
      <!-- <script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script> -->
      <!-- Place your code in the script tags below -->

    <script type="text/javascript">
      var layer;
      var vector = [];
      var legend;


      function main() {

          var Legend_simu = new cdb.geo.ui.Legend.Density({
              title: 'Conductivité thermique simulé (W/mK)',
              left: "2", right: "4", colors: [ "#3783bb", "#a7d0e4", "#f7f6f6", "#f7b799", "#c94741"]
          });
          var Legend_std = new cdb.geo.ui.Legend.Density({
              title: 'Incertitude',
              left: "Faible", right: "Élevée", colors: [ "#3783bb", "#a7d0e4", "#f7f6f6", "#f7b799", "#c94741"]
          });
          var Legend_geology = new cdb.geo.ui.Legend.Custom({
            title: "Formations et groupes géologiques",
            data: [
              { name: "Lorraine - Formation de Nicolet ",  value: "#e5d0a9" },
              { name: "Shale d'Utica ",  value: "#cba053" },
              { name: "Trenton - Formation de Tétrauville ",  value: "#d7e4f9" },
              { name: "Trenton - Formation de  Montréal",       value: "#3d99fc" },
              { name: "Trenton - Formation de Deschambault",         value: "#aacbfd" },
              { name: "Black River",         value: "#44f4f3" },
              { name: "Chazy - Formation de Laval",          value: "#d6ffff" },
              { name: "Beekmantown - Formation de Beauharnois",          value: "#eae1fc" },
              { name: "Beekmantown - Formation de Theresa",          value: "#fcea91" },
              { name: "Postsdam - Formation de Cairnside",          value: "#fdfcb5" },
              { name: "Postsdam - Formation de Covey Hill",          value: "#f4d854" }
            ]
          });
          var Legend_thermostrati = new cdb.geo.ui.Legend.Custom({
            title: "Unités thermostratigraphiques",
            data: [
              { name: "Queenston et Lorraine",  value: "#ffffcc" },
              { name: "St. Rosalie et Utica",       value: "#ffeda0" },
              { name: "Trenton, Black River, Chazy",         value: "#fed976" },
              { name: "Beauharnois",         value: "#feb24c" },
              { name: "Theresa",          value: "#fd8d3c" },
              { name: "Cairnside et Covey Hill",         value: "#fc4e2a" },
              { name: "Appalaches",          value: "#e31a1c" },
              { name: "Grenville",         value: "#b10026" }

            ]
          });
          var Legend_epaisseur = new cdb.geo.ui.Legend.Density({
              title: 'Epaisseur dépôts meubles (m)',
              left: "5", right: "150", colors: [ "#f7fcf0", "#e0f3db", "#ccebc5", "#a8ddb5", "#7bccc4","#4eb3d3","#2b8cbe","#0868ac"]
          });



        var map = L.map('map', {
          zoomControl: false,
          center: [45.575551, -73.714161],
          zoom: 12
        });

        // add basemap
       L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png', {attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}).addTo(map);
       // add CartoDB layer
       var sublayers = [];
        cartodb.createLayer(map, {
          user_name: 'lperozzi',
          type: 'cartodb',
          sublayers: [{
              sql: "SELECT * FROM geology",
              cartocss: $("#thermostraticss").text()
          },
          {
              sql: "SELECT * FROM geology",
              cartocss: $("#geologycss").text()
          },
          {
              sql: "SELECT * FROM epaisseur",
              cartocss: $("#epaisseurcss").text()
          },
          {
              sql: "SELECT cartodb_id,the_geom,r3,the_geom_webmercator FROM sgs_grid_2", // Earthquake data
              cartocss: $("#r3css").text()
          },
          {
              sql: "SELECT cartodb_id,the_geom,mean,the_geom_webmercator FROM sgs_grid_2", // Earthquake data
              cartocss: $("#meancss").text()
          },
          {
              sql: "SELECT cartodb_id,the_geom,std,the_geom_webmercator FROM sgs_grid_2", // Earthquake data
              cartocss: $("#stdcss").text()
          },
          {
              sql: "SELECT * FROM marmot_forages_affleurements_copy", // Earthquake data
              cartocss: $("#mesurescss").text()
          },
          {
              sql: "SELECT * FROM marmot_forages_affleurements_copy_1",
              cartocss: $("#mesurescss").text()
          },
          {
              sql: "SELECT * FROM data_synth ", // Earthquake data
              cartocss: $("#datasynthscss").text()
          }]
        }).addTo(map)
        .done(function(layer) {
            // var searchBox = cdb.vis.Overlay.create('search', map_object, {});
            // searchBox.show();
            // $('#map').append(searchBox.render().el);
                // sublayers[2].hide()
            for (var i = 0; i < layer.getSubLayerCount(); i++) {
                sublayers[i] = layer.getSubLayer(i);
                // sublayers.hide();
                // alert("Congrats, you added sublayer #" + i + "!");
            }
          // add search box
        //   var searchBox = cdb.vis.Overlay.create('search', map.viz, {});
        //   searchBox.show();
        //   $('#map').append(searchBox.render().el);


          sublayers[0].hide()
          sublayers[1].hide()
          sublayers[2].hide()
          sublayers[3].hide()
          sublayers[4].hide()
          sublayers[5].hide()
          sublayers[6].show()
          sublayers[7].show()
          sublayers[8].hide()

          layer.leafletMap.viz.addOverlay({
                  type: 'tooltip',
                  layer: sublayers[7],
                  template: $('#infowindow_mesures').text(),
                  position: 'bottom|right',
                  fields: [{ cond: 'cond' }]
              });
          sublayers[7].set({ 'interactivity': ['cartodb_id', 'cond'] });
          sublayers[7].infowindow.set('template', $('#infowindow_mesures').html());

          layer.leafletMap.viz.addOverlay({
                  type: 'tooltip',
                  layer: sublayers[6],
                  template: $('#infowindow_mesures').text(),
                  position: 'bottom|right',
                  fields: [{ cond: 'cond' }]
              });
          sublayers[6].set({ 'interactivity': ['cartodb_id', 'cond'] });
          sublayers[6].infowindow.set('template', $('#infowindow_mesures').html());



          var op = 0.7;
          layer.setOpacity(op);

          $(function() {
             $( "#slider-range-min" ).slider({
               range: "min",
               value: 70,
               min: 0,
               max: 100,
               slide: function( event, ui ) {
                 $( "#amount" ).val(ui.value + "%" );
                 op = $( "#slider-range-min" ).slider( "value" ) / 100;
                 layer.setOpacity(op);
               }
             });
             $( "#amount" ).val( $( "#slider-range-min" ).slider( "value" ) + "%");
          });

          var sublayer0Shown = true;
              $("#thermostrati").on('click', function() {
                  if (sublayer0Shown) {
                  sublayers[0].show();
                  sublayers[1].hide();
                  sublayers[2].hide();
                  // $(Legend_thermostrati.render().el).show()
                  $('#map').append(Legend_thermostrati.render().el);
                  $(Legend_std.render().el).hide()
                  $(Legend_simu.render().el).hide()
                  $(Legend_geology.render().el).hide()
                  $(Legend_epaisseur.render().el).hide()
                  $(Legend_thermostrati.render().el).show()
                      // layer.leafletMap.viz.addOverlay({
                      //         type: 'infobox',
                      //         layer: sublayers[0],
                              // template: $('#infowindow_termostrati').text(),
                      //         position: 'top|right',
                      //         fields: [{ unite_stra: 'unite_stra' }]

                      //     });

                      // sublayers[0].set({ 'interactivity': ['unite_stra'] });
                      // sublayers[0].infowindow.set('template', $('#infowindow_thermostrati').html());
                      cartodb.vis.Vis.addInfowindow(map, sublayers[0], ['unite_stra'],{
                       infowindowTemplate: $('#infowindow_thermostrati').html(),
                       templateType: 'mustache'
                       });

                  } else {
                      sublayers[0].hide();
                      $(Legend_thermostrati.render().el).hide()
                      $(Legend_std.render().el).hide()
                      $(Legend_simu.render().el).hide()
                      $(Legend_geology.render().el).hide()
                      $(Legend_epaisseur.render().el).hide()
                      $(Legend_thermostrati.render().el).hide()
                  }
                  sublayer0Shown = !sublayer0Shown;
              });

             var sublayer1Shown = true;
                 $("#geology").on('click', function() {
                     if (sublayer1Shown) {
                          sublayers[1].show();
                          sublayers[0].hide();
                          sublayers[2].hide();
                          // $(Legend_geology.render().el).show()
                          $('#map').append(Legend_geology.render().el);
                          $(Legend_thermostrati.render().el).hide()
                          $(Legend_std.render().el).hide()
                          $(Legend_simu.render().el).hide()
                          $(Legend_epaisseur.render().el).hide()
                          $(Legend_geology.render().el).show()
                          cartodb.vis.Vis.addInfowindow(map, sublayers[1], ['formation'],{
                           infowindowTemplate: $('#infowindow_geology').html(),
                           templateType: 'mustache'
                           });
                      } else {
                          sublayers[1].hide();
                          $(Legend_thermostrati.render().el).hide()
                          $(Legend_std.render().el).hide()
                          $(Legend_simu.render().el).hide()
                          $(Legend_geology.render().el).hide()
                          $(Legend_epaisseur.render().el).hide()
                          // $(Legend_geology.render().el).hide()
                      }
                      sublayer1Shown = !sublayer1Shown;
                  });
              var sublayer2Shown = true;
                  $("#epaisseur").on('click', function() {

                      if (sublayer2Shown) {
                          sublayers[2].show();
                          sublayers[0].hide();
                          sublayers[1].hide();
                          // $(Legend_epaisseur.render().el).show()
                          $('#map').append(Legend_epaisseur.render().el);
                          $(Legend_thermostrati.render().el).hide()
                          $(Legend_std.render().el).hide()
                          $(Legend_simu.render().el).hide()
                          $(Legend_geology.render().el).hide()
                          $(Legend_epaisseur.render().el).show()
                          cartodb.vis.Vis.addInfowindow(map, sublayers[2], ['gridcode'],{
                           infowindowTemplate: $('#infowindow_epaisseur').html(),
                           templateType: 'mustache'
                           });
                      } else {
                          sublayers[2].hide();
                          $(Legend_thermostrati.render().el).hide()
                          $(Legend_std.render().el).hide()
                          $(Legend_simu.render().el).hide()
                          $(Legend_geology.render().el).hide()
                          $(Legend_epaisseur.render().el).hide()
                          // $(Legend_epaisseur.render().el).hide()
                      }
                      sublayer2Shown = !sublayer2Shown;
                  });

                  var sublayer3Shown = true;
                      $("#real").on('click', function() {

                          if (sublayer3Shown) {
                              sublayers[3].show();
                              sublayers[4].hide();
                              sublayers[5].hide();

                              // $(Legend_simu.render().el).show()
                              $('#map').append(Legend_simu.render().el);
                              $(Legend_thermostrati.render().el).hide()
                              $(Legend_std.render().el).hide()
                              $(Legend_geology.render().el).hide()
                              $(Legend_epaisseur.render().el).hide()
                              $(Legend_simu.render().el).show()
                              layer.leafletMap.viz.addOverlay({
                                      type: 'tooltip',
                                      layer: sublayers[3],
                                      template: $('#infowindow_r3').text(),
                                      position: 'bottom|left',
                                      fields: [{ r3: 'r3' }]
                                  });
                              sublayers[3].set({ 'interactivity': ['r3'] });
                              sublayers[3].infowindow.set('template', $('#infowindow_r3').html());
                          } else {
                              sublayers[3].hide();
                              $(Legend_thermostrati.render().el).hide()
                              $(Legend_std.render().el).hide()
                              $(Legend_simu.render().el).hide()
                              $(Legend_geology.render().el).hide()
                              $(Legend_epaisseur.render().el).hide()
                              // $(Legend_simu.render().el).hide()
                          }
                          sublayer3Shown = !sublayer3Shown;
                      });

                  var sublayer4Shown = true;
                      $("#mean").on('click', function() {

                          if (sublayer4Shown) {
                              sublayers[4].show();
                              sublayers[3].hide();
                              sublayers[5].hide();
                              // $(Legend_simu.render().el).show()
                              $('#map').append(Legend_simu.render().el);
                              $(Legend_thermostrati.render().el).hide()
                              $(Legend_std.render().el).hide()
                              $(Legend_geology.render().el).hide()
                              $(Legend_epaisseur.render().el).hide()
                              $(Legend_simu.render().el).show()
                              layer.leafletMap.viz.addOverlay({
                                      type: 'tooltip',
                                      layer: sublayers[4],
                                      template: $('#infowindow_mean').text(),
                                      position: 'bottom|left',
                                      fields: [{mean: 'mean' }]
                                  });
                              sublayers[4].set({ 'interactivity': ['mean'] });
                              sublayers[4].infowindow.set('template', $('#infowindow_mean').html());
                          } else {
                              sublayers[4].hide();
                              $(Legend_thermostrati.render().el).hide()
                              $(Legend_std.render().el).hide()
                              $(Legend_simu.render().el).hide()
                              $(Legend_geology.render().el).hide()
                              $(Legend_epaisseur.render().el).hide()
                              // $(Legend_simu.render().el).hide()
                          }
                          sublayer4Shown = !sublayer4Shown;
                      });
                  var sublayer5Shown = true;
                      $("#std").on('click', function() {

                          if (sublayer5Shown) {
                              sublayers[5].show();
                              sublayers[4].hide();
                              sublayers[3].hide();
                              // $(Legend_std.render().el).show()
                              $('#map').append(Legend_std.render().el);
                              $(Legend_thermostrati.render().el).hide()
                              $(Legend_simu.render().el).hide()
                              $(Legend_geology.render().el).hide()
                              $(Legend_epaisseur.render().el).hide()
                              $(Legend_std.render().el).show()
                              layer.leafletMap.viz.addOverlay({
                                      type: 'tooltip',
                                      layer: sublayers[5],
                                      template: $('#infowindow_std').text(),
                                      position: 'bottom|left',
                                      fields: [{ std: 'std' }]
                                  });
                              sublayers[5].set({ 'interactivity': ['std'] });
                              sublayers[5].infowindow.set('template', $('#infowindow_std').html());
                          } else {
                              sublayers[5].hide();
                              $(Legend_thermostrati.render().el).hide()
                              $(Legend_std.render().el).hide()
                              $(Legend_simu.render().el).hide()
                              $(Legend_geology.render().el).hide()
                              $(Legend_epaisseur.render().el).hide()
                              // $(Legend_std.render().el).hide()
                          }
                          sublayer5Shown = !sublayer5Shown;
                      });
                  var sublayer6Shown = false;
                      $("#affleurement").on('click', function() {

                          if (sublayer6Shown) {
                              sublayers[6].show();
                              // $(Legend_simu.render().el).show()
                              // $('#map').append(Legend_simu.render().el);
                              // layer.leafletMap.viz.addOverlay({
                              //         type: 'tooltip',
                              //         layer: sublayers[6],
                              //         template: $('#infowindow_mesures').text(),
                              //         position: 'bottom|left',
                              //         fields: [{ std: 'cond' }]
                              //     });
                              // sublayers[6].set({ 'interactivity': ['cartodb_id', 'cond'] });
                              // sublayers[6].infowindow.set('template', $('#infowindow_template').html());
                              // $(Legend_thermostrati.render().el).hide()
                              // $(Legend_std.render().el).hide()
                              // $(Legend_geology.render().el).hide()
                              // $(Legend_epaisseur.render().el).hide()
                              // $(Legend_simu.render().el).show()
                          } else {
                              sublayers[6].hide();
                              // $(Legend_thermostrati.render().el).hide()
                              // $(Legend_std.render().el).hide()
                              // $(Legend_simu.render().el).hide()
                              // $(Legend_geology.render().el).hide()
                              // $(Legend_epaisseur.render().el).hide()
                              // $(Legend_simu.render().el).hide()
                          }
                          sublayer6Shown = !sublayer6Shown;
                      });
                      var sublayer7Shown = false;
                          $("#forage").on('click', function() {

                              if (sublayer7Shown) {
                                  sublayers[7].show();
                                  // $(Legend_simu.render().el).show()
                                  // $('#map').append(Legend_simu.render().el);
                                  // sublayers[7].set({ 'interactivity': ['cartodb_id', 'cond'] });
                                  // sublayers[7].infowindow.set('template', $('#infowindow_mesures').html());
                                  // $(Legend_thermostrati.render().el).hide()
                                  // $(Legend_std.render().el).hide()
                                  // $(Legend_geology.render().el).hide()
                                  // $(Legend_epaisseur.render().el).hide()
                                  // $(Legend_simu.render().el).show()
                              } else {
                                  sublayers[7].hide();

                                  // $(Legend_thermostrati.render().el).hide()
                                  // $(Legend_std.render().el).hide()
                                  // $(Legend_simu.render().el).hide()
                                  // $(Legend_geology.render().el).hide()
                                  // $(Legend_epaisseur.render().el).hide()
                                  // $(Legend_simu.render().el).hide()
                              }
                              sublayer7Shown = !sublayer7Shown;
                          });
                      var sublayer8Shown = true;
                          $("#synth").on('click', function() {

                              if (sublayer8Shown) {
                                  sublayers[8].show();
                                  // $(Legend_simu.render().el).show()
                                  // $('#map').append(Legend_simu.render().el);
                                  layer.leafletMap.viz.addOverlay({
                                          type: 'tooltip',
                                          layer: sublayers[8],
                                          template: $('#infowindow_synth').text(),
                                          position: 'bottom|left',
                                          fields: [{ std: 'cond' }]
                                      });
                                  sublayers[8].set({ 'interactivity': ['cartodb_id', 'cond'] });
                                  sublayers[8].infowindow.set('template', $('#infowindow_synth').html());
                                  // $(Legend_thermostrati.render().el).hide()
                                  // $(Legend_std.render().el).hide()
                                  // $(Legend_geology.render().el).hide()
                                  // $(Legend_epaisseur.render().el).hide()
                                  // $(Legend_simu.render().el).show()
                              } else {
                                  sublayers[8].hide();
                                  // $(Legend_thermostrati.render().el).hide()
                                  // $(Legend_std.render().el).hide()
                                  // $(Legend_simu.render().el).hide()
                                  // $(Legend_geology.render().el).hide()
                                  // $(Legend_epaisseur.render().el).hide()
                                  // $(Legend_simu.render().el).hide()
                              }
                              sublayer8Shown = !sublayer8Shown;
                          });


                            var searchBox = cdb.vis.Overlay.create('search', map.viz, {});
                            searchBox.show();
                            $('#map').append(searchBox.render().el);







        })
        .error(function(err) {
            console.log("error: " + err);
        });

    }

      window.onload = main;

    </script>
  </body>
</html>
